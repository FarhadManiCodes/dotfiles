#!/bin/bash
# tmux-jupyter-single - Single Jupyter instance manager for Python Development menu
# Location: ~/.local/bin/tmux-jupyter-single

SESSION_NAME=$(tmux display-message -p '#S')
WINDOW_NAME="jupyter-dev"

echo "ğŸ” Checking for existing Jupyter development window..."

# Check if jupyter window already exists in current session
if tmux list-windows -t "$SESSION_NAME" | grep -q "$WINDOW_NAME"; then
  # Window exists, switch to it
  echo "âœ… Found existing Jupyter window, switching to it..."
  tmux select-window -t "$WINDOW_NAME"
  echo "ğŸ“± Switched to existing Jupyter window"
else
  # Create new window with Jupyter + logs layout
  echo "ğŸš€ Creating new Jupyter development window..."

  # Create new window
  tmux new-window -n "$WINDOW_NAME"

  # Create layout: 80% top for logs, 20% bottom for Jupyter
  tmux split-window -v -p 20

  # Layout visualization:
  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚         Live Logs (80%)             â”‚
  # â”‚ tail -f jupyter-lab-logs...         â”‚
  # â”‚                                     â”‚
  # â”‚                                     â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚      Jupyter Starter (20%)          â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  # Bottom pane (20%): Start Jupyter Lab
  tmux select-pane -t 1
  tmux send-keys "echo 'ğŸš€ Starting Jupyter Lab for development...'" Enter
  tmux send-keys "jupyter-smart 8888" Enter

  # Top pane (80%): Show logs with interactive control
  tmux select-pane -t 0
  tmux send-keys "echo 'ğŸ“Š Jupyter Lab Logs (Live) - 80% view'" Enter
  tmux send-keys "echo 'Press Ctrl+C to stop logs and get options'" Enter
  tmux send-keys "echo 'Waiting for Jupyter to start and generate logs...'" Enter
  tmux send-keys "echo ''" Enter
  tmux send-keys "sleep 3" Enter
  tmux send-keys "~/.local/bin/jupyter-log-monitor" Enter

  echo "âœ… Jupyter development window created - 80% logs, 20% starter"
fi
